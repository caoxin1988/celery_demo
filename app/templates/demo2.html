<!DOCTYPE HTML>
<html>
<head>
	<title>Flask-SocketIO-Celery</title>
	<script type="text/javascript" src="//code.jquery.com/jquery-1.4.2.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
</head>
<body>
	<h1>Flask-SocketIO-Celery Demo2</h1>
	<br>

	<p id="emit_name">hello, {{ name }}, this is demo2_view</p>
	<br>

    <button id="start-bg-job">Start Background Job</button>
    <br>
	<br>
	<br>

	<h2>Receive:</h2>
	<p id="receive_div"></p>

	<script type="text/javascript">
        $(document).ready(function() {
        	namespace = '/test_conn';
        	console.log('document ready');

        	var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + namespace);

        	function start_long_task() {
				console.log('start long task with ajax')
                $.ajax({
					type: 'GET',
					url : '/longtask',
					success: function (data, status, request) {
						console.log('ajax success ' + data['data'])
					},
                    error: function () {
						console.log('ajax get an error')
						alert('ajax error')
					}
				})
			}

			$('#start-bg-job').click(start_long_task)

		});

	</script>
</body>
</html>